<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../img/favicon.ico">
    <title>Quick-Start - Yosai</title>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">
    <link href="../css/extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">

            <!-- Collapsed navigation -->
            <div class="navbar-header">

                <!-- Expander button -->
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
                <!-- Main title -->
                <a class="navbar-brand" href="..">Yosai</a>
            </div>
            <!-- Expanded navigation -->
            <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Get Started <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="../intro/">Introduction</a>
                            </li>
                            <li>
                                <a href="../installation_setup/">Installation and Setup</a>
                            </li>
                            <li class="active">
                                <a href="./">Quick-Start</a>
                            </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="../authentication/">Authentication</a>
                            </li>
                            <li>
                                <a href="../authorization/">Authorization</a>
                            </li>
                            <li>
                                <a href="../sessionmanagement/">Session Management</a>
                            </li>
                            <li>
                                <a href="../events/">Event Processing</a>
                            </li>
                            <li>
                                <a href="../serialization/">Serialization</a>
                            </li>
                            <li>
                                <a href="../architecture/">Architecture Overview</a>
                                <a href="../web/">Web Integration</a>
                            </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">More <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="../devstatus/">Development Status</a>
                            </li>
                            <li>
                                <a href="../library/">Library</a>
                            </li>
                            <li>
                                <a href="../community/">Community</a>
                            </li>
                            <li>
                                <a href="../contributing/">Contributing</a>
                            </li>
                            <li>
                                <a href="../code_of_conduct/">Code of Conduct</a>
                            </li>
                            <li>
                                <a href="../credits/">Credits</a>
                            </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="tutorials/totp_tutorial">TOTP Authentication</a>
                            </li>
                        </ul>
                    </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fa fa-search"></i> Search
                        </a>
                    </li>

                    <li>
                        <a rel="next" href="../installation_setup/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li>
                        <a rel="prev" href="../authentication/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/yosaiproject">

                            <i class="fa fa-github"></i> GitHub
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>


  <div class="container">

                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">

        <li class="main active"><a href="#yosai-quick-start">Yosai:  Quick-Start</a></li>

            <li><a href="#overview">Overview</a></li>

            <li><a href="#install">Install</a></li>

            <li><a href="#configure">Configure</a></li>

            <li><a href="#instantiate-a-yosai-instance">Instantiate a Yosai instance</a></li>

            <li><a href="#use">Use</a></li>


    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="yosai-quick-start">Yosai:  Quick-Start</h1>
<p>Yosai is a powerful framework that can take you far.  This Quick-Start
guide is intended to help you get started by going through basic usage while
not burdening you with detail.  This is an opinionated quick-start in that it
requires that you use Redis for caching and a relational database for your
data store.</p>
<h2 id="overview">Overview</h2>
<p>Following are the steps that you will go through to use Yosai:</p>
<ol>
<li>Install</li>
<li>Configure</li>
<li>Instantiate</li>
<li>Use</li>
</ol>
<h2 id="install">Install</h2>
<p>First, install Yosai from PyPI using pip:</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>pip install yosai
</pre></div>


<p>Installing from PyPI, using pip, will install the project package that includes
<code>yosai.core</code> and <code>yosai.web</code>, a default configuration, and project dependencies.</p>
<h2 id="configure">Configure</h2>
<p>Yosai is configured through a YAML-formatted settings file.  An example of
this configuration file can be found within the <a href="https://github.com/YosaiProject/yosai/blob/master/yosai/core/conf/yosai_settings.yaml">yosai.core.conf directory</a>
of the Yosai project, named <code>yosai_settings.yaml</code>.  When you initialize a Yosai
instance, you specify as an argument <em>either</em> a file_path to a configured settings
file or an environment variable (env_var) that references the location of this file in
the system that will use Yosai:</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>  <span style="color: #75715e">#option 1</span>
  <span style="color: #f8f8f2">yosai</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Yosai(env_var</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;ANY_ENV_VAR_NAME_YOU_WANT&#39;</span><span style="color: #f8f8f2">)</span>

  <span style="color: #75715e">#option 2</span>
  <span style="color: #f8f8f2">yosai</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Yosai(file_path</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;/../../../whatever_filename_you_want.yaml&#39;</span><span style="color: #f8f8f2">)</span>
</pre></div>


<h3 id="caching">Caching</h3>
<p>Yosai has full support for caching.  Caching is enabled by default and ought to be used.</p>
<p>There's a Yosai extension library, <code>yosai_dpcache</code>, that is a
fork of Mike Bayer's popular "dogpile" projects -- core and cache -- but
customized for Yosai's serialization preferences.  Currently, <code>yosai_dpcache</code>
supports Redis.  Pull requests to support other cache stores are welcome.</p>
<p>Install yosai_dpcache from PyPI using pip:</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>pip install yosai_dpcache
</pre></div>


<p><code>yosai_dpcache</code> can be configured either through the main Yosai settings file or by
manually passing in settings arguments to a DPCacheHandler class.  For QuickStart
demonstration purposes, we'll use the settings file, including the following
for a local redis server:</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>CACHE_HANDLER:
    init_config:
        backend: <span style="color: #e6db74">&#39;yosai_dpcache.redis&#39;</span>
        region_name: <span style="color: #e6db74">&#39;yosai_dpcache&#39;</span>
    server_config:
      redis:
        url: <span style="color: #e6db74">&#39;127.0.0.1&#39;</span>
        host: <span style="color: #e6db74">&#39;localhost&#39;</span>
        port: 6379
</pre></div>


<h3 id="persistence">Persistence</h3>
<p>You have to register a persistent data store, such as a database, that Yosai
will request user credentials and authorization information from.  A fully
operational relational data store has been created for you to help you get
started:  <code>yosai_alchemystore</code>.  <code>yosai_alchemystore</code> uses the SQLAlchemy ORM
to interface with an underlying relational database.  </p>
<p>Install yosai_alchemystore from PyPI using pip:</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>pip install yosai_alchemystore
</pre></div>


<p>Just as with <code>yosai_dpcache</code>, <code>yosai_alchemystore</code> is configured either using
a settings file or by instantiating an instance with a settings
argument. For QuickStart purposes, we'll use the settings file.</p>
<p>The settings file requires that ALCHEMY_STORE settings be set, if you
would like to use the <code>yosai_alchemystore</code>.  Here is what those settings look
like for a sqlite database located with <code>theuser</code>'s home directory.</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>ALCHEMY_STORE:
    engine_config:
        dialect: sqlite
        path: ////home/theuser/yosai_accounts.db
</pre></div>


<p>There is a python script within the yosai_alchemystore repo, <a href="https://github.com/YosaiProject/yosai_alchemystore/blob/master/yosai_alchemystore/conf/create_populate_db.py">create_populate_db.py</a>, that populates test data within a sqlite database.  </p>
<h2 id="instantiate-a-yosai-instance">Instantiate a Yosai instance</h2>
<p>Altogether, here is how you QuickStart instantiate an instance of Yosai:</p>
<p>1) Install yosai, yosai_alchemystore, and yosai_dpcache from pypi:  </p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>pip install yosai yosai_alchemystore yosai_dpcache
</pre></div>


<p>2) Declare an environment variable, in this case <code>YOSAI_SETTINGS</code>, and assign
it to the location of the yaml settings file in your filesystem, such as:</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">export</span> <span style="color: #f8f8f2">YOSAI_SETTINGS</span><span style="color: #f92672">=</span>/home/theuser/yosai_settings.yaml
</pre></div>


<p>3) Edit the yosai_settings.yaml file, updating settings for <code>ALCHEMY_STORE</code> and <code>CACHE_HANDLER</code></p>
<p>4) Instantiate a yosai instance:</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">from</span> <span style="color: #f8f8f2">yosai.core</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">Yosai</span>

<span style="color: #f8f8f2">yosai</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Yosai(env_var</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;YOSAI_SETTINGS&#39;</span><span style="color: #f8f8f2">)</span>
</pre></div>


<h3 id="quick-starting-yosai-web">Quick-Starting Yosai Web</h3>
<p>The <code>yosai</code> project features a <code>yosai.core</code> package and <code>yosai.web</code>
integration library.</p>
<p>If you're using Yosai for web application development, use the <code>yosai.web</code>
library to instantiate Yosai.  <code>yosai.web</code> is a derivative of <code>yosai.core</code>,
extended to support interactions with web request/response objects.</p>
<p>In the Instantiation step above, we create a core Yosai instance.  We could have
instantiated a web-enabled WebYosai instance by making a small change to the
yosai_settings.yaml file, changing the security_manager configuration from</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>SECURITY_MANAGER_CONFIG:
    security_manager: yosai.core.NativeSecurityManager
</pre></div>


<p>to</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span>SECURITY_MANAGER_CONFIG:
    security_manager: yosai.core.WebSecurityManager
</pre></div>


<p>and then instantiating as follows:</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">from</span> <span style="color: #f8f8f2">yosai.web</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">WebYosai</span>

<span style="color: #f8f8f2">yosai</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">WebYosai(env_var</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;YOSAI_SETTINGS&#39;</span><span style="color: #f8f8f2">)</span>
</pre></div>


<h2 id="use">Use</h2>
<p>The following example was created to illustrate the myriad ways that you
can declare an authorization policy in an application, ranging from general
role-level specification to very specific "scoped" permissions.  The
authorization policy is as follows:</p>
<ul>
<li>Either a user with role membership "patient" or "nurse" may request a
  refill of a medical prescription</li>
<li>A user who is granted permission to write prescriptions may obtain the
  list of pending prescription refill requests</li>
<li>A user who is granted permission to write prescriptions for a specific
  patient may issue a prescription for that patient</li>
</ul>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">from</span> <span style="color: #f8f8f2">yosai.core</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">Yosai</span>

<span style="color: #a6e22e">@Yosai.requires_role</span><span style="color: #f8f8f2">(roleid_s</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&#39;patient&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;nurse&#39;</span><span style="color: #f8f8f2">],</span> <span style="color: #f8f8f2">logical_operator</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">any)</span>
<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">request_prescription_refill</span><span style="color: #f8f8f2">(patient,</span> <span style="color: #f8f8f2">prescription):</span>
    <span style="color: #f92672">...</span>


<span style="color: #a6e22e">@Yosai.requires_permission</span><span style="color: #f8f8f2">([</span><span style="color: #e6db74">&#39;prescription:write&#39;</span><span style="color: #f8f8f2">])</span>
<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">get_prescription_refill_requests</span><span style="color: #f8f8f2">(patient):</span>
    <span style="color: #f92672">...</span>


<span style="color: #a6e22e">@Yosai.requires_dynamic_permission</span><span style="color: #f8f8f2">([</span><span style="color: #e6db74">&#39;prescription:write:{patient.patient_id}&#39;</span><span style="color: #f8f8f2">])</span>
<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">issue_prescription</span><span style="color: #f8f8f2">(patient,</span> <span style="color: #f8f8f2">prescription):</span>
    <span style="color: #f92672">...</span>
</pre></div>


<p>Note how the authorization policy is declared using authorization-specific
decorators.  These decorators are associated with the yosai instance
passed into the context where decorated functions/methods are called:</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">with</span> <span style="color: #f8f8f2">Yosai</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">context(yosai):</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">prescription</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">get_prescription_refill_requests(patient):</span>
        <span style="color: #f8f8f2">issue_prescription(patient,</span> <span style="color: #f8f8f2">prescription)</span>
</pre></div>


<p>If you were using Yosai with a web application, a context-management approach
is used again but different types of objects are passed into context, specifically a
<code>WebYosai</code> instance and a <code>WebRegistry</code> instance:</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">with</span> <span style="color: #f8f8f2">WebYosai</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">context(yosai,</span> <span style="color: #f8f8f2">web_registry):</span>
   <span style="color: #75715e"># handle web request here</span>
</pre></div></div>

        </div>

        <footer class="col-md-12">
            <hr>

            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>
        <script src="../js/extra.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
