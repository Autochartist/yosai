<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>04.totp_logins on </title>
    <link>https://yosaiproject.github.io/yosai/tutorials/totp_tutorial/04/index.totp_login/</link>
    <description>Recent content in 04.totp_logins on </description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Sun, 20 Nov 2016 15:16:11 -0500</lastBuildDate>
    <atom:link href="https://yosaiproject.github.io/yosai/tutorials/totp_tutorial/04.totp_login/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Step 2: TOTP Login</title>
      <link>https://yosaiproject.github.io/yosai/tutorials/totp_tutorial/04.totp_login/</link>
      <pubDate>Sun, 20 Nov 2016 15:16:11 -0500</pubDate>
      
      <guid>https://yosaiproject.github.io/yosai/tutorials/totp_tutorial/04.totp_login/</guid>
      <description>

&lt;h2 id=&#34;center-step-2-totp-login-center&#34;&gt;&lt;center&gt; Step 2: TOTP Login &lt;/center&gt;&lt;/h2&gt;

&lt;p&gt;If a user is configured for two-factor authentication and username/password
is verified, Yosai signals to the calling application to collect 2FA information
from its client by raising an &lt;strong&gt;AdditionalAuthenticationRequired&lt;/strong&gt; exception.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;        try:
            new_subject.login(password_token)
        except AdditionalAuthenticationRequired:
            # this is pseudocode:
            request_totp_token_from_client()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Additionally, Yosai will call an &lt;strong&gt;MFADispatcher&lt;/strong&gt;, if one is configured,
to send information to the client.  One such implementation of an
&lt;strong&gt;MFADispatcher&lt;/strong&gt; is an &lt;a href=&#34;https://github.com/YosaiProject/yosai_totp_sms&#34;&gt;SMSDispatcher&lt;/a&gt;
that SMS messages a client a newly-generated TOTP token (a 6-digit integer).
The Dispatcher is called prior to raising the AdditionalAuthenticationRequired exception.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;img/totp_sms.png&#34; alt=&#34;mfa_dispatcher&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;totp-authentication-step-3-totp-key-entry&#34;&gt;TOTP Authentication Step 3: TOTP Key Entry&lt;/h3&gt;

&lt;p&gt;Client is prompted to enter a TOTP token.  Client submits the requested
totp token to the server, authenticating itself.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;img/totp_token.png&#34; alt=&#34;totp_token_login&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;server-side-second-authentication-request-totptoken&#34;&gt;Server-side Second Authentication Request:  TOTPToken&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;    with Yosai.context(yosai):
        new_subject = Yosai.get_current_subject()

        totp_token = TOTPToken(client_provided_totp_token)

        try:
            new_subject.login(totp_token)
        except IncorrectCredentialsException:
            # incorrect totp token provided
        except LockedAccountException:
            # too many failed TOTP authentication attempts, account locked
        except InvalidAuthenticationSequenceException:
            # when TOTPToken authentication is attempted prior to username/password
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;token-consumption&#34;&gt;Token Consumption&lt;/h2&gt;

&lt;p&gt;In order to control for a one-time password to truly be used once, Yosai caches
the TOTP Token that successfully authenticated.  If an attacker were to try to
replay totp authentication, any subsequent TOTP authentication of the valid
token would raise an IncorrectCredentialsException.  Granted, without this
token consumption facility, an attacker would have a very small window of
opportunity &amp;ndash; seconds &amp;ndash; to replay a TOTP Token before a new one would be required for
authentication.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>